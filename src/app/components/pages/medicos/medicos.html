<div class="container-fluid medicos-page">
    <!-- T√çTULO + BOT√ÉO NOVO -->
    <div class="row mb-4">
        <div class="col">
            <h2 class="mb-0">M√©dicos</h2>
            <small class="text-muted">Gerencie os m√©dicos cadastrados na cl√≠nica</small>
        </div>

        <div class="col-auto d-flex align-items-center">
            <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#modalCadastroMedico">
                + Novo M√©dico
            </button>

        </div>
    </div>
    <div *ngIf="mensagemPagPrincipal() != ''" class="alert alert-{{tipoMensagem()}} alert-dismissible fade show">
        <strong>{{ mensagemPagPrincipal() }}</strong>
        <button type="button" class="btn-close" aria-label="Close" (click)="mensagemPagPrincipal.set('')"></button>
    </div>

    <!-- LISTA DE M√âDICOS -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <!-- T√≠tulo centralizado -->
                        <div class="col text-center">
                            <span class="fw-bold fs-5">M√©dicos cadastrados</span>
                        </div>

                        <!-- Campo de pesquisa -->
                        <div class="col-auto d-flex align-items-center">
                            <form [formGroup]="formPesquisarMedico" (ngSubmit)="pesquisarPorNome()" class="d-flex">

                                <input type="text" class="form-control search-input" formControlName="nomeMedico"
                                    placeholder="Pesquisar por nome...">

                                <button type="submit" class="sidebar-btn ms-2" *ngIf="ativarBodyPesquisa()==false"
                                    [disabled]="formPesquisarMedico.invalid">
                                    <span class="menu-icon">üîç</span>
                                </button>
                            </form>
                            <button type="button" class="sidebar-btn ms-2" *ngIf="ativarBodyPesquisa()==true"
                                (click)="consultarMedicos(0)">
                                <span class="menu-icon">‚úñÔ∏è</span>
                            </button>
                        </div>

                    </div>
                </div>

                <!-- TABELA -->
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table mb-0 align-middle">
                            <thead class="table-light">
                                <!-- TITULO DA TABELA -->
                                <tr>
                                    <th>Nome do m√©dico</th>
                                    <th>CPF</th>
                                    <th>CRM</th>
                                    <th>WhatsApp</th>
                                    <th style="width: 180px;">A√ß√µes</th>
                                </tr>
                            </thead>

                            <!-- CORPO DA TABELA -->
                            <tbody *ngIf="ativarBodyPesquisa()==false">
                                <!-- FOR DIN√ÇMICO AO INICIAR A P√ÅG:-->
                                <tr *ngFor="let medico of medicos()">
                                    <td>{{ medico.nomeMedico }}</td>
                                    <td>{{ aplicarMascaraCPF(medico.cpfMedico) }}</td>
                                    <td>{{ medico.crmMedico }}</td>
                                    <td>{{ aplicarMascaraWhats(medico.whatsAppMedico)}}</td>
                                    <td>
                                        <div style="width: 180px;" class="d-flex gap-2">
                                            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal"
                                                data-bs-target="#modalEditarMedico" (click)="abrirModalEditar(medico)">
                                                Editar
                                            </button>

                                            <button *ngIf="medico.statusAtivo == true" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal"
                                                data-bs-target="#modalConfirmarDesativarMedico"
                                                (click)="abrirModalConfirmarDelete(medico)">
                                                Desativar
                                            </button>
                                            <button *ngIf="medico.statusAtivo == false" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                                                data-bs-target="#modalConfirmarAtivarMedico"
                                                (click)="abrirModalConfirmarDelete(medico)">
                                                Ativar
                                            </button>
                                        </div>
                                    </td>
                                </tr>

                            </tbody>

                            <tbody *ngIf="ativarBodyPesquisa()==true">
                                <!-- FOR DIN√ÇMICO AO PESQUISAR MEDICO-->
                                <tr *ngFor="let medico of medicosFounds()">
                                    <td>{{ medico.nomeMedico }}</td>
                                    <td>{{ aplicarMascaraCPF(medico.cpfMedico) }}</td>
                                    <td>{{ medico.crmMedico }}</td>
                                    <td>{{ aplicarMascaraWhats(medico.whatsAppMedico)}}</td>
                                    <td>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal"
                                                data-bs-target="#modalEditarMedico" (click)="abrirModalEditar(medico)">
                                                Editar
                                            </button>

                                            <button *ngIf="medico.statusAtivo == true" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal"
                                                data-bs-target="#modalConfirmarDesativarMedico"
                                                (click)="abrirModalConfirmarDelete(medico)">
                                                Desativar
                                            </button>

                                            <button *ngIf="medico.statusAtivo == false" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                                                data-bs-target="#modalConfirmarAtivarMedico"
                                                (click)="abrirModalConfirmarDelete(medico)">
                                                Ativar
                                            </button>
                                        </div>
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- PAGINA√á√ÉO DARK PREMIUM -->
                <nav class="pagination-container" *ngIf="ativarBodyPesquisa()==false">
                    <ul class="pagination-dark">

                        <!-- Bot√£o Anterior -->
                        <li>
                            <button class="page-btn" [class.disabled]="paginaAtual() === 0"
                                (click)="irParaPagina(paginaAtual() - 1)">
                                <i class="bi bi-chevron-left"></i>
                            </button>
                        </li>

                        <!-- N√∫meros -->
                        <li *ngFor="let page of totalPaginasArray()">
                            <button class="page-btn" [class.active]="page === paginaAtual()"
                                (click)="irParaPagina(page)">
                                {{ page + 1 }}
                            </button>
                        </li>

                        <!-- Bot√£o Pr√≥ximo -->
                        <li>
                            <button class="page-btn" [class.disabled]="paginaAtual() === totalPaginas() - 1"
                                (click)="irParaPagina(paginaAtual() + 1)">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- ----------------------------------------------------------------------------------------------------------- -->
<!-- ---------------------------------------------MODAL DE CADASTRO--------------------------------------------- -->
<!-- ----------------------------------------------------------------------------------------------------------- -->
<div class="modal fade" id="modalCadastroMedico" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Cabe√ßalho -->
            <div class="modal-header">
                <h5 class="modal-title t text-center w-100">Cadastrar M√©dico</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Corpo (formul√°rio) -->
            <div class="modal-body">
                <form [formGroup]="formAddMedico" (ngSubmit)="addMedico()">

                    <!-- Nome -->
                    <div class="mb-3">
                        <label class="form-label">Nome do m√©dico</label>
                        <input type="text" class="form-control" formControlName="nomeMedico"
                            (input)="formAddMedico.get('nomeMedico')?.setValue(capitalizarNome($event.target.value), {emitEvent: false})"
                            [class.is-invalid]="formAddMedico.get('nomeMedico')?.invalid && formAddMedico.get('nomeMedico')?.touched">

                        <!-- Mensagens de erro -->
                        <div class="invalid-feedback"
                            *ngIf="formAddMedico.get('nomeMedico')?.hasError('required') && formAddMedico.get('nomeMedico')?.touched">
                            Nome √© obrigat√≥rio.
                        </div>

                        <div class="invalid-feedback"
                            *ngIf="formAddMedico.get('nomeMedico')?.hasError('pattern') && formAddMedico.get('nomeMedico')?.touched">
                            Apenas letras e espa√ßos. M√≠nimo 1 ‚Äì M√°ximo 100 caracteres.
                        </div>
                    </div>

                    <!-- CPF -->
                    <div class="mb-3">
                        <label class="form-label">CPF</label>
                        <input type="text" class="form-control" formControlName="cpfMedico"
                            [class.is-invalid]="formAddMedico.get('cpfMedico')?.invalid && formAddMedico.get('cpfMedico')?.touched"
                            mask="000.000.000-00">

                        <div class="invalid-feedback"
                            *ngIf="formAddMedico.get('cpfMedico')?.hasError('required') && formAddMedico.get('cpfMedico')?.touched">
                            CPF √© obrigat√≥rio.
                        </div>

                        <div class="invalid-feedback"
                            *ngIf="formAddMedico.get('cpfMedico')?.hasError('pattern') && formAddMedico.get('cpfMedico')?.touched">
                            Formato inv√°lido. Ex: 000.000.000-00
                        </div>
                    </div>

                    <!-- CRM -->
                    <div class="mb-3">
                        <label class="form-label">CRM</label>
                        <input type="text" class="form-control" formControlName="crmMedico"
                            [class.is-invalid]="formAddMedico.get('crmMedico')?.invalid && formAddMedico.get('crmMedico')?.touched">

                        <div class="invalid-feedback"
                            *ngIf="formAddMedico.get('crmMedico')?.hasError('required') && formAddMedico.get('crmMedico')?.touched">
                            CRM √© obrigat√≥rio.
                        </div>

                        <div class="invalid-feedback"
                            *ngIf="formAddMedico.get('crmMedico')?.hasError('pattern') && formAddMedico.get('crmMedico')?.touched">
                            Apenas letras e n√∫meros. Entre 4 e 20 caracteres.
                        </div>
                    </div>

                    <!-- WhatsApp -->
                    <div class="mb-3">
                        <label class="form-label">WhatsApp</label>
                        <input type="text" class="form-control" formControlName="whatsAppMedico"
                            [class.is-invalid]="formAddMedico.get('whatsAppMedico')?.invalid && formAddMedico.get('whatsAppMedico')?.touched"
                            mask="(00)0000-0000||(00)00000-0000">

                        <div class="invalid-feedback"
                            *ngIf="formAddMedico.get('whatsAppMedico')?.hasError('required') && formAddMedico.get('whatsAppMedico')?.touched">
                            WhatsApp √© obrigat√≥rio.
                        </div>

                        <div class="invalid-feedback"
                            *ngIf="formAddMedico.get('whatsAppMedico')?.hasError('pattern') && formAddMedico.get('whatsAppMedico')?.touched">
                            Formato inv√°lido. Ex: (21)99999-0000
                        </div>
                    </div>

                    <!-- Rodap√© -->

                    <div [ngClass]="{ 'show': mensagemModal() != '' }"
                        class="alert alert-{{tipoMensagem()}} alert-dismissible fade show">
                        <strong>{{ mensagemModal() }}</strong>
                        <button type="button" class="btn-close" aria-label="Close"
                            (click)="mensagemModal.set('')"></button>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                            Cancelar
                        </button>

                        <button type="submit" class="btn btn-dark" [disabled]="formAddMedico.invalid">
                            Salvar
                        </button>
                        <!-- Bot√£o escondido s√≥ para fechar via TS -->
                        <button #btnCloseAddModal type="button" class="d-none" data-bs-dismiss="modal">
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- ----------------------------------------------------------------------------------------------------------- -->
<!-- ---------------------------------------------MODAL DE EDICAO----------------------------------------------- -->
<!-- ----------------------------------------------------------------------------------------------------------- -->
<div class="modal fade" id="modalEditarMedico" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Cabe√ßalho -->
            <div class="modal-header">
                <h5 class="modal-title t text-center w-100">Editar dados do M√©dico</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Corpo (formul√°rio) -->
            <div class="modal-body">
                <form [formGroup]="formEditMedico" (ngSubmit)="editarMedico()">

                    <!-- Nome -->
                    <div class="mb-3">
                        <label class="form-label">Nome do m√©dico</label>
                        <input type="text" class="form-control" formControlName="nomeMedico"
                            (input)="formEditMedico.get('nomeMedico')?.setValue(capitalizarNome($event.target.value), {emitEvent: false})"
                            [class.is-invalid]="formEditMedico.get('nomeMedico')?.invalid && formEditMedico.get('nomeMedico')?.touched">

                        <!-- Mensagens de erro -->
                        <div class="invalid-feedback"
                            *ngIf="formEditMedico.get('nomeMedico')?.hasError('required') && formEditMedico.get('nomeMedico')?.touched">
                            Nome √© obrigat√≥rio.
                        </div>

                        <div class="invalid-feedback"
                            *ngIf="formEditMedico.get('nomeMedico')?.hasError('pattern') && formEditMedico.get('nomeMedico')?.touched">
                            Apenas letras e espa√ßos. M√≠nimo 1 ‚Äì M√°ximo 100 caracteres.
                        </div>
                    </div>

                    <!-- CPF -->
                    <div class="mb-3">
                        <label class="form-label">CPF</label>
                        <input type="text" class="form-control" formControlName="cpfMedico"
                            [class.is-invalid]="formEditMedico.get('cpfMedico')?.invalid && formEditMedico.get('cpfMedico')?.touched"
                            mask="000.000.000-00">

                        <div class="invalid-feedback"
                            *ngIf="formEditMedico.get('cpfMedico')?.hasError('required') && formEditMedico.get('cpfMedico')?.touched">
                            CPF √© obrigat√≥rio.
                        </div>

                        <div class="invalid-feedback"
                            *ngIf="formEditMedico.get('cpfMedico')?.hasError('pattern') && formEditMedico.get('cpfMedico')?.touched">
                            Formato inv√°lido. Ex: 000.000.000-00
                        </div>
                    </div>

                    <!-- CRM -->
                    <div class="mb-3">
                        <label class="form-label">CRM</label>
                        <input type="text" class="form-control" formControlName="crmMedico"
                            [class.is-invalid]="formEditMedico.get('crmMedico')?.invalid && formEditMedico.get('crmMedico')?.touched">

                        <div class="invalid-feedback"
                            *ngIf="formEditMedico.get('crmMedico')?.hasError('required') && formEditMedico.get('crmMedico')?.touched">
                            CRM √© obrigat√≥rio.
                        </div>

                        <div class="invalid-feedback"
                            *ngIf="formEditMedico.get('crmMedico')?.hasError('pattern') && formEditMedico.get('crmMedico')?.touched">
                            Apenas letras e n√∫meros. Entre 4 e 20 caracteres.
                        </div>
                    </div>

                    <!-- WhatsApp -->
                    <div class="mb-3">
                        <label class="form-label">WhatsApp</label>
                        <input type="text" class="form-control" formControlName="whatsAppMedico"
                            [class.is-invalid]="formEditMedico.get('whatsAppMedico')?.invalid && formEditMedico.get('whatsAppMedico')?.touched"
                            mask="(00)0000-0000||(00)00000-0000">

                        <div class="invalid-feedback"
                            *ngIf="formEditMedico.get('whatsAppMedico')?.hasError('required') && formEditMedico.get('whatsAppMedico')?.touched">
                            WhatsApp √© obrigat√≥rio.
                        </div>

                        <div class="invalid-feedback"
                            *ngIf="formEditMedico.get('whatsAppMedico')?.hasError('pattern') && formEditMedico.get('whatsAppMedico')?.touched">
                            Formato inv√°lido. Ex: (21)99999-0000
                        </div>
                    </div>
                    <div [ngClass]="{ 'show': mensagemModal() != '' }"
                        class="alert alert-{{tipoMensagem()}} alert-dismissible fade show">
                        <strong>{{ mensagemModal() }}</strong>
                        <button type="button" class="btn-close" aria-label="Close"
                            (click)="mensagemModal.set('')"></button>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                            Cancelar
                        </button>

                        <button type="submit" class="btn btn-dark" [disabled]="formEditMedico.invalid">
                            Editar
                        </button>
                        <!-- Bot√£o escondido s√≥ para fechar via TS -->
                        <button #btnCloseEditModal type="button" class="d-none" data-bs-dismiss="modal">
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ----------------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------MODAL DE ATIVAR------------------------------------------------ -->
<!-- ----------------------------------------------------------------------------------------------------------- -->
<div class="modal fade" id="modalConfirmarAtivarMedico" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Cabe√ßalho -->
            <div class="modal-header">
                <h5 class="modal-title">Confirmar ativa√ß√£o</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Corpo -->
            <div class="modal-body">
                <p>
                    Tem certeza que deseja reativar o(a) m√©dico(a)
                    <strong>{{ medicoSelecionadoParaDelete?.nomeMedico }}</strong>?
                </p>
                <p class="text-muted mb-0">
                    Essa a√ß√£o poder√° ser desfeita desativando novamente.
                </p>
            </div>

            <!-- Rodap√© -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cancelar
                </button>

                <button type="button" class="btn btn-primary" (click)="deletarMedico()" data-bs-dismiss="modal">
                    Reativar
                </button>
            </div>

        </div>
    </div>
</div>

<!-- ----------------------------------------------------------------------------------------------------------- -->
<!-- -------------------------------------------MODAL DE DESATIVAR---------------------------------------------- -->
<!-- ----------------------------------------------------------------------------------------------------------- -->
<div class="modal fade" id="modalConfirmarDesativarMedico" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Cabe√ßalho -->
            <div class="modal-header">
                <h5 class="modal-title">Confirmar desativa√ß√£o</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Corpo -->
            <div class="modal-body">
                <p>
                    Tem certeza que deseja desativar o(a) m√©dico(a)
                    <strong>{{ medicoSelecionadoParaDelete?.nomeMedico }}</strong>?
                </p>
                <p class="text-muted mb-0">
                    Essa a√ß√£o poder√° ser desfeita ativando novamente.
                </p>
            </div>

            <!-- Rodap√© -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cancelar
                </button>

                <button type="button" class="btn btn-danger" (click)="deletarMedico()" data-bs-dismiss="modal">
                    Desativar
                </button>
            </div>

        </div>
    </div>
</div>